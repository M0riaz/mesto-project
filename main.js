(()=>{"use strict";document.querySelector(".popup__toggle-edit-button ");var e=document.querySelector(".profile__editor"),t=document.querySelector(".popup__admin-new-place"),n=document.querySelector(".popup__admin"),o=document.querySelector(".popup__item_value_name"),r=document.querySelector(".popup__item_value_hobby"),c=document.querySelector(".profile__button"),a=document.querySelector(".elements__list"),u=document.querySelector(".card-template").content,i=(document.querySelector(".popup__toggle-big-image"),document.querySelector(".popup__toggle-add-image"),document.querySelector(".profile__name")),l=document.querySelector(".profile__status"),s=document.querySelector(".popup-profile"),d=document.querySelector(".popup_opened-big-image"),p=document.querySelector(".popup_opened-image"),m=document.querySelectorAll(".popup"),_=document.querySelector(".popup__item_value_link"),f=document.querySelector(".popup__item_value_new-place"),v=(document.querySelectorAll(".popup__toggle"),document.querySelector(".popup__button-create")),h=document.querySelector(".popup__image"),y=document.querySelector(".popup__image-comment"),S=(document.querySelector(".elements__delite-button"),document.querySelector(".profile__avatar-button")),b=document.querySelector(".popup-profile-change-avatar"),q=document.querySelector(".popup__admin-change-avatar"),g=document.querySelector(".profile__avatar"),E=document.querySelector(".popup__item_value_link-avatar"),L=document.querySelectorAll(".popup__button");function C(e){e.classList.add("popup_opened"),document.addEventListener("keydown",x)}function k(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",x)}function x(e){"Escape"===e.key&&k(document.querySelector(".popup_opened"))}function A(e,t,n,o,r){var c=u.querySelector(".elements__card").cloneNode(!0),a=c.querySelector(".elements__image"),i=c.querySelector(".elements__title"),l=c.querySelector(".elements__delite-button"),s=c.querySelector(".elements__button"),p=c.querySelector(".elements__like-counter");return o?l.addEventListener("click",(function(){D(r),c.remove()})):l.remove(),a.src=t,i.textContent=e,a.alt=e,p.textContent=n,s.addEventListener("click",(function(){s.classList.contains("elements__button_active")?O(r).then((function(e){p.textContent=e.likes.length,s.classList.remove("elements__button_active")})):N(r).then((function(e){p.textContent=e.likes.length,s.classList.add("elements__button_active")}))})),a.addEventListener("click",(function(){h.src=t,y.textContent=e,h.alt=e,C(d)})),c}m.forEach((function(e){e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup_opened")&&k(e),t.target.classList.contains("popup__toggle")&&k(e)}))}));var U={baseUrl:"https://nomoreparties.co/v1/plus-cohort-21",headers:{authorization:"c920339b-2c17-46f2-a77c-c209db7e0a7d","Content-Type":"application/json"}};function T(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}function w(e){console.log("ой что то не так с отображением карточек "+e)}var B,D=function(e){return fetch("".concat(U.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:U.headers,body:JSON.stringify({_id:e})}).then(T).catch(w)},N=function(e){return fetch("".concat(U.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:U.headers}).then(T).catch(w)},O=function(e){return fetch("".concat(U.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:U.headers}).then(T).catch(w)},P=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.inactiveButtonClass),t.removeAttribute("disabled")):(t.classList.add(n.inactiveButtonClass),t.setAttribute("disabled","disabled"))};function J(e){L.forEach((function(t){t.textContent=e?"Сохранение...":t===v?"Создать":"Сохранить"}))}fetch("".concat(U.baseUrl,"/cards"),{headers:U.headers}).then(T).catch(w).then((function(e){e.forEach((function(e){var t=A(e.name,e.link,e.likes.length,"342d9355557abfcd73d1c01d"===e.owner._id,e._id);a.append(t)}))})),fetch("".concat(U.baseUrl,"/users/me"),{headers:U.headers}).then(T).catch(w).then((function(e){i.textContent=e.name,l.textContent=e.about,g.src=e.avatar})),t.addEventListener("submit",(function(e){J(!0),e.preventDefault();var t,n,o,r=A(f.value,_.value);(n=f.value,o=_.value,fetch("".concat(U.baseUrl,"/cards"),{method:"POST",headers:U.headers,body:JSON.stringify({name:n,link:o})}).then(T).catch(w)).finally((function(){J(!1)})),k(p),e.target.reset(),t=r,a.prepend(t)})),e.addEventListener("click",(function(){C(s)})),n.addEventListener("submit",(function(e){var t,n;J(!0),e.preventDefault(),i.textContent=o.value,l.textContent=r.value,(t=o.value,n=r.value,fetch("".concat(U.baseUrl,"/users/me"),{method:"PATCH",headers:U.headers,body:JSON.stringify({name:t,about:n})}).then(T).catch(w)).finally((function(){J(!1)})),k(s)})),c.addEventListener("click",(function(){C(p)})),S.addEventListener("click",(function(){C(b)})),q.addEventListener("submit",(function(e){var t;J(!0),e.preventDefault(),(t=E.value,fetch("".concat(U.baseUrl,"/users/me/avatar "),{method:"PATCH",headers:U.headers,body:JSON.stringify({avatar:t})}).then(T).catch(w)).finally((function(){J(!1)})),g.src=E.value,k(b),console.log(E.value),e.target.reset()})),B={formSelector:".popup__admin",inputSelector:".popup__item",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__item_error",errorClass:"popup__input-error_active"},Array.from(document.querySelectorAll(B.formSelector)).forEach((function(e){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);P(n,o,t),e.addEventListener("reset",(function(){setTimeout((function(){P(n,o,t)}),0)})),n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(n.inputErrorClass),r.textContent=o,r.classList.add(n.errorClass)}(e,t,n,t.validationMessage)}(e,r,t),P(n,o,t)}))}))}(e,B)}))})();