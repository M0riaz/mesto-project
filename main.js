(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{x:()=>H}),document.querySelector(".popup__toggle-edit-button ");var t=document.querySelector(".profile__editor"),n=document.querySelector(".popup__admin-new-place"),o=document.querySelector(".popup__admin"),r=document.querySelector(".popup__item_value_name"),c=document.querySelector(".popup__item_value_hobby"),a=document.querySelector(".profile__button"),u=document.querySelector(".elements__list"),i=document.querySelector(".card-template").content,l=(document.querySelector(".popup__toggle-big-image"),document.querySelector(".popup__toggle-add-image"),document.querySelector(".profile__name")),s=document.querySelector(".profile__status"),d=document.querySelector(".popup-profile"),p=document.querySelector(".popup_opened-big-image"),m=document.querySelector(".popup_opened-image"),_=document.querySelectorAll(".popup"),f=document.querySelector(".popup__item_value_link"),v=document.querySelector(".popup__item_value_new-place"),y=(document.querySelectorAll(".popup__toggle"),document.querySelector(".popup__button-create")),h=document.querySelector(".popup__image"),S=document.querySelector(".popup__image-comment"),b=(document.querySelector(".elements__delite-button"),document.querySelector(".profile__avatar-button")),q=document.querySelector(".popup-profile-change-avatar"),g=document.querySelector(".popup__admin-change-avatar"),L=document.querySelector(".profile__avatar"),E=document.querySelector(".popup__item_value_link-avatar"),C=document.querySelectorAll(".popup__button");function k(e){e.classList.add("popup_opened"),document.addEventListener("keydown",A)}function x(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",A)}function A(e){"Escape"===e.key&&x(document.querySelector(".popup_opened"))}function O(e){var t=i.querySelector(".elements__card").cloneNode(!0),n=t.querySelector(".elements__image"),o=t.querySelector(".elements__title"),r=t.querySelector(".elements__delite-button"),c=t.querySelector(".elements__button"),a=t.querySelector(".elements__like-counter");function u(e){var t=H(e);a.textContent=t.count,t.isOwnerLike?c.classList.add("elements__button_active"):c.classList.remove("elements__button_active")}return e.owner._id!==U?r.remove():r.addEventListener("click",(function(){B(e._id),t.remove()})),n.src=e.link,o.textContent=e.name,n.alt=e.name,u(e),c.addEventListener("click",(function(){c.classList.contains("elements__button_active")?N(e._id).then((function(e){u(e)})):D(e._id).then((function(e){u(e)}))})),n.addEventListener("click",(function(){h.src=e.link,S.textContent=e.name,h.alt=e.name,k(p)})),t}_.forEach((function(e){e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup_opened")&&x(e),t.target.classList.contains("popup__toggle")&&x(e)}))}));var U="342d9355557abfcd73d1c01d",w={baseUrl:"https://nomoreparties.co/v1/plus-cohort-21",headers:{authorization:"c920339b-2c17-46f2-a77c-c209db7e0a7d","Content-Type":"application/json"}};function T(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}function P(e){console.log("ой что то не так с отображением карточек "+e)}var j,B=function(e){return fetch("".concat(w.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:w.headers,body:JSON.stringify({_id:e})}).then(T).catch(P)},D=function(e){return fetch("".concat(w.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:w.headers}).then(T).catch(P)},N=function(e){return fetch("".concat(w.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:w.headers}).then(T).catch(P)},J=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.inactiveButtonClass),t.removeAttribute("disabled")):(t.classList.add(n.inactiveButtonClass),t.setAttribute("disabled","disabled"))};function M(e){C.forEach((function(t){t.textContent=e?"Сохранение...":t===y?"Создать":"Сохранить"}))}function H(e){return{count:e.likes.length,isOwnerLike:e.likes.some((function(e){return e._id===U}))}}fetch("".concat(w.baseUrl,"/cards"),{headers:w.headers}).then(T).catch(P).then((function(e){e.forEach((function(e){var t=O(e);u.append(t)}))})),fetch("".concat(w.baseUrl,"/users/me"),{headers:w.headers}).then(T).catch(P).then((function(e){l.textContent=e.name,s.textContent=e.about,L.src=e.avatar})),n.addEventListener("submit",(function(e){var t,n;M(!0),e.preventDefault(),(t=v.value,n=f.value,fetch("".concat(w.baseUrl,"/cards"),{method:"POST",headers:w.headers,body:JSON.stringify({name:t,link:n})}).then(T).catch(P)).then((function(e){!function(e,t){t.prepend(e)}(O(e),u)})).finally((function(){M(!1)})),x(m),e.target.reset()})),t.addEventListener("click",(function(){r.value=l.textContent,c.value=s.textContent,k(d)})),o.addEventListener("submit",(function(e){var t,n;M(!0),e.preventDefault(),l.textContent=r.value,s.textContent=c.value,(t=r.value,n=c.value,fetch("".concat(w.baseUrl,"/users/me"),{method:"PATCH",headers:w.headers,body:JSON.stringify({name:t,about:n})}).then(T).catch(P)).finally((function(){M(!1)})),x(d)})),a.addEventListener("click",(function(){k(m)})),b.addEventListener("click",(function(){k(q)})),g.addEventListener("submit",(function(e){var t;M(!0),e.preventDefault(),(t=E.value,fetch("".concat(w.baseUrl,"/users/me/avatar "),{method:"PATCH",headers:w.headers,body:JSON.stringify({avatar:t})}).then(T).catch(P)).finally((function(){M(!1)})),L.src=E.value,x(q),console.log(E.value),e.target.reset()})),j={formSelector:".popup__admin",inputSelector:".popup__item",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__item_error",errorClass:"popup__input-error_active"},Array.from(document.querySelectorAll(j.formSelector)).forEach((function(e){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);J(n,o,t),e.addEventListener("reset",(function(){setTimeout((function(){J(n,o,t)}),0)})),n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(n.inputErrorClass),r.textContent=o,r.classList.add(n.errorClass)}(e,t,n,t.validationMessage)}(e,r,t),J(n,o,t)}))}))}(e,j)}))})();